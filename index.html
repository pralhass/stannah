<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Selecionar ponto focal</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        margin-top: 40px;
      }
      input, select, button {
        padding: 10px;
        font-size: 16px;
        margin: 10px;
        width: 300px;
      }
      input.error, select.error {
        border: 2px solid red;
      }
      img {
        margin-top: 20px;
        max-width: 80%;
        border: 1px solid #ccc;
      }
      #previewTemplate {
        margin-top: 20px;
        max-width: 400px;
        display: none;
      }
    </style>
  </head>
  <body>

    <h2>Preenche os dados e clica no ponto focal da imagem</h2>

    <!-- CAMPO TEMPLATE PRIMEIRO -->
    <select id="template">
      <option value="">Seleciona um template</option>
      <option value="1st Promo">1st Promo</option>
      <option value="StannahGuidelines">Stannah Guidelines</option>
      <option value="NewLookV1">New Look V1</option>
      <option value="NewLookV2">New Look V2</option>
      <option value="NewLookV3">New Look V3</option>
      <option value="NewLookV4">New Look V4</option>
    </select>
    <br />
    <img id="previewTemplate" alt="Pré-visualização do template" />
    <br />

    <!-- RESTO DOS CAMPOS -->
    <input type="text" id="title" placeholder="Título" />
    <br />
    <input type="text" id="subtitle" placeholder="Subtítulo" />
    <br />
    <input type="text" id="cta" placeholder="Call to Action" />
    <br />
    <input type="text" id="imageUrlInput" placeholder="URL da Imagem" />
    <br />
    <input type="text" id="videoUrlInput" placeholder="URL do Vídeo" />
    <br />

    <button onclick="loadImage()">Carregar imagem</button>
    <br />
    <img id="image" style="display:none;" />

    <script>
      const img = document.getElementById("image");
      const imageUrlInput = document.getElementById("imageUrlInput");
      const templateSelect = document.getElementById("template");
      const previewImg = document.getElementById("previewTemplate");

      // Função para converter link da Google Drive em thumbnail
      function convertGoogleDriveUrl(url) {
        const match = url.match(/\/d\/([a-zA-Z0-9_-]+)\//);
        if (match && match[1]) {
          const id = match[1];
          return `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
        }
        return url;
      }

      // Links reais dos templates na Drive (coloca aqui os teus)
      const templatePreviewsRaw = {
        "1st Promo": "",
        "StannahGuidelines": "https://drive.google.com/file/d/1G9oWyGbD2c9oUwmGmI-SUYYTm2RuIldW/view?usp=sharing",
        "NewLookV1": "",
        "NewLookV2": "https://drive.google.com/file/d/1jR5Upc8gsuzTV2ykx9qDYNAaXjksVhOo/view?usp=sharing",
        "NewLookV3": "https://drive.google.com/file/d/1lzNWQFXRwnv0n5GrCfLl284TTLyyF5jM/view?usp=sharing",
        "NewLookV4": "https://drive.google.com/file/d/1M6N8GLorcmVOmonXc0sq6nGpiAxMnvHi/view?usp=sharing"
      };

      // Atualiza imagem de pré-visualização ao mudar template
      templateSelect.addEventListener("change", function () {
        const selected = templateSelect.value;
        if (templatePreviewsRaw[selected]) {
          const converted = convertGoogleDriveUrl(templatePreviewsRaw[selected]);
          previewImg.src = converted;
          previewImg.style.display = "block";
        } else {
          previewImg.style.display = "none";
        }
      });

      // Botão para carregar imagem real
      function loadImage() {
        const rawUrl = imageUrlInput.value.trim();
        const url = convertGoogleDriveUrl(rawUrl);
        img.src = url;
        img.style.display = "block";
      }

      // Clique na imagem real para capturar coordenadas
      img.addEventListener("click", function (e) {
        const fields = {
          title: document.getElementById("title"),
          subtitle: document.getElementById("subtitle"),
          cta: document.getElementById("cta"),
          imageUrl: document.getElementById("imageUrlInput"),
          videoUrl: document.getElementById("videoUrlInput"),
          template: document.getElementById("template")
        };

        let missingFields = [];

        // Verificar campos obrigatórios
        Object.entries(fields).forEach(([key, field]) => {
          const isEmpty = !field.value.trim();
          field.classList.toggle("error", isEmpty);
          if (isEmpty) {
            const labelMap = {
              title: "Título",
              subtitle: "Subtítulo",
              cta: "Call to Action",
              imageUrl: "URL da Imagem",
              videoUrl: "URL do Vídeo",
              template: "Template"
            };
            missingFields.push(labelMap[key]);
          }
        });

        if (missingFields.length > 0) {
          alert(
            `Por favor preenche os seguintes campos obrigatórios:\n- ${missingFields.join("\n- ")}`
          );
          return;
        }

        const rect = img.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / img.width) * 100;
        const y = ((e.clientY - rect.top) / img.height) * 100;

        const data = {
          title: fields.title.value.trim(),
          subtitle: fields.subtitle.value.trim(),
          cta: fields.cta.value.trim(),
          image_url: fields.imageUrl.value.trim(),
          video_url: fields.videoUrl.value.trim(),
          template: fields.template.value,
          focus_x: Math.round(x),
          focus_y: Math.round(y)
        };

        fetch("https://hook.eu2.make.com/ud2ltvos440cz2b6kw82dykit54gxurv", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        alert(`Dados enviados com sucesso!\nX: ${Math.round(x)}\nY: ${Math.round(y)}`);
      });
    </script>
  </body>
</html>
