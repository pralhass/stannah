<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Selecionar ponto focal</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        margin-top: 40px;
      }
      input, select, button {
        padding: 10px;
        font-size: 16px;
        margin: 10px;
        width: 300px;
      }
      img {
        margin-top: 20px;
        max-width: 80%;
        border: 1px solid #ccc;
      }
      #previewTemplate {
        margin-top: 20px;
        max-width: 400px;
        display: none;
      }
    </style>
  </head>
  <body>

    <h2>Preenche os dados e clica no ponto focal da imagem</h2>

    <input type="text" id="title" placeholder="Título" />
    <br />
    <input type="text" id="subtitle" placeholder="Subtítulo" />
    <br />
    <input type="text" id="cta" placeholder="Call to Action" />
    <br />
    <input type="text" id="imageUrlInput" placeholder="URL da Imagem" />
    <br />
    <input type="text" id="videoUrlInput" placeholder="URL do Vídeo" />
    <br />
    <select id="template">
      <option value="">Seleciona um template</option>
      <option value="1st Promo">1st Promo</option>
      <option value="StannahGuidelines">Stannah Guidelines</option>
      <option value="NewLookV1">New Look V1</option>
      <option value="NewLookV2">New Look V2</option>
      <option value="NewLookV3">New Look V3</option>
      <option value="NewLookV4">New Look V4</option>
    </select>
    <br />
    <img id="previewTemplate" alt="Pré-visualização do template" />
    <br />
    <button onclick="loadImage()">Carregar imagem</button>
    <br />
    <img id="image" style="display:none;" />

    <script>
      const img = document.getElementById("image");
      const imageUrlInput = document.getElementById("imageUrlInput");
      const templateSelect = document.getElementById("template");
      const previewImg = document.getElementById("previewTemplate");

      // Mapa de templates para imagens de pré-visualização
      const templatePreviews = {
        "1st Promo": "https://via.placeholder.com/400x200?text=1st+Promo",
        "StannahGuidelines": "https://www.stannah.com/media/.renditions/wysiwyg/why-stannah-large_1.jpg",
        "NewLookV1": "https://via.placeholder.com/400x200?text=New+Look+V1",
        "NewLookV2": "https://via.placeholder.com/400x200?text=New+Look+V2",
        "NewLookV3": "https://drive.google.com/file/d/1lzNWQFXRwnv0n5GrCfLl284TTLyyF5jM/view?usp=sharing",
        "NewLookV4": "https://via.placeholder.com/400x200?text=New+Look+V4"
      };

      // Atualiza imagem de pré-visualização ao mudar template
      templateSelect.addEventListener("change", function () {
        const selected = templateSelect.value;
        if (templatePreviews[selected]) {
          previewImg.src = templatePreviews[selected];
          previewImg.style.display = "block";
        } else {
          previewImg.style.display = "none";
        }
      });

      // Função para converter links do Google Drive
      function convertGoogleDriveUrl(url) {
        const match = url.match(/\/d\/([a-zA-Z0-9_-]+)\//);
        if (match && match[1]) {
          const id = match[1];
          return `https://drive.google.com/thumbnail?id=${id}&sz=w1000`;
        }
        return url;
      }

      // Carrega imagem real a partir do campo URL
      function loadImage() {
        const rawUrl = imageUrlInput.value.trim();
        const url = convertGoogleDriveUrl(rawUrl);
        img.src = url;
        img.style.display = "block";
      }

      // Captura clique na imagem real
      img.addEventListener("click", function (e) {
        const rect = img.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / img.width) * 100;
        const y = ((e.clientY - rect.top) / img.height) * 100;

        const data = {
          title: document.getElementById("title").value,
          subtitle: document.getElementById("subtitle").value,
          cta: document.getElementById("cta").value,
          image_url: document.getElementById("imageUrlInput").value,
          video_url: document.getElementById("videoUrlInput").value,
          template: document.getElementById("template").value,
          focus_x: Math.round(x),
          focus_y: Math.round(y)
        };

        fetch("https://hook.eu2.make.com/ud2ltvos440cz2b6kw82dykit54gxurv", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        alert(`Dados enviados com sucesso!\nX: ${Math.round(x)}\nY: ${Math.round(y)}`);
      });
    </script>
  </body>
</html>
